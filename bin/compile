#!/bin/bash

if [ ! -f "$3/ENFORCE_APP_NAMING_PATTERN" ]; then
    echo "ENFORCE_APP_NAMING_PATTERN not set in Heroku environment variables. Skipping check."
    exit 0
fi

ENFORCE_APP_NAMING_PATTERN=$(cat $3/ENFORCE_APP_NAMING_PATTERN)
HEROKU_APP_NAME=$(cat $3/HEROKU_APP_NAME)

echo "Checking app name $HEROKU_APP_NAME against $ENFORCE_APP_NAMING_PATTERN"

if [[ $HEROKU_APP_NAME != $ENFORCE_APP_NAMING_PATTERN ]]; then
    # The app name starts with vtv3dev-, so we exit
    echo "Build halted - does not match app name $HEROKU_APP_NAME does not match pattern $ENFORCE_APP_NAME"
    exit 1
fi

echo "App name $HEROKU_APP_NAME matches pattern $ENFORCE_APP_NAMING_PATTERN. Continuing with build..."
